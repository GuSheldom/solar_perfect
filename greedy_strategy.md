# 贪心放电策略优化模型说明

## 📋 模型概述

本模型实现了基于贪心策略的储能放电优化，核心思想是：**在最高电价时段优先放电**。

---

## 🎯 核心逻辑

### 1️⃣ **充电阶段**（POA > 10 时段）

```
目标：在低价时段充满电池
方法：
  1. 筛选出 POA > 10 的可充电时段
  2. 按 RRP 从低到高排序
  3. 依次充电直至电池充满（SOC = 5504 kWh）
  4. 优先使用光伏充电，不足时从电网补充
```

**约束条件**：
- 充电功率 ≤ 2752 kW
- 从电网充电功率 ≤ 670 kW (NIL)
- 充电效率 = 95%

---

### 2️⃣ **放电阶段**（POA > 5 窗口内）

```
窗口定义：从当天第一个 POA > 5 到次日第一个 POA > 5 之间

目标：在高价时段优先放电
方法：
  1. 在放电窗口内，排除已用于充电的时段
  2. 按 RRP 从高到低排序
  3. 依次决定是否放电：
     
     a) 如果 POA > 5（白天有光伏）：
        - 光伏功率 ≥ NEL(4440kW) → 只用光伏，按NEL发电
        - 光伏功率 < NEL → 光伏+储能一起发电至NEL
     
     b) 如果 POA ≤ 5（夜间无光伏）：
        - 按最大放电功率(2752kW)放电
  
  4. 持续放电直至 SOC = 0 或无剩余高价时段
```

**约束条件**：
- 放电功率 ≤ 2752 kW
- 总上网功率 ≤ 4440 kW (NEL)
- 放电效率 = 95%
- 当 RRP ≤ -10 AUD/MWh 时不上网（弃电）

---

### 3️⃣ **光伏处理**（剩余时段）

```
对于既不充电也不放电的时段：
  - 如果 RRP > -10：光伏直接上网（不超过NEL）
  - 如果 RRP ≤ -10：光伏弃电
```

---

## 📊 运行结果（31天数据）

### 💰 **收益统计**

| 指标 | 数值 |
|------|------|
| **累计净收益** | **$119,784.02** |
| 上网收益 | $120,756.58 |
| 购电成本 | $972.56 |
| 平均日收益 | $3,864.00 |
| **年化估算** | **$1,410,360.24/年** |

**最佳收益日**: 2025-07-02，收益 $58,083.74

---

### ⚡ **能量统计**

| 能量流 | 数值 | 占比 |
|--------|------|------|
| **光伏总发电** | 368,549 kWh | 100% |
| └─ 用于充电 | 121,879 kWh | 33.1% |
| └─ 直接上网 | 184,595 kWh | **50.1%** ⭐ |
| └─ 弃电 | 62,075 kWh | 16.8% |
| **从电网购电** | 52,220 kWh | - |
| **总充电量** | 174,099 kWh | - |
| **总放电量** | 157,372 kWh | - |
| **储能上网** | 149,503 kWh | - |
| **总上网量** | 334,098 kWh | - |

---

### 🔋 **电池表现**

- **放电利用率**: 90.4% (157,372 / 174,099)
- **每日平均放电**: 5,076 kWh
- **大多数天数SOC降至0**: 充分利用了储能套利机会

---

### 📈 **动作分布**

| 动作类型 | 时段数 | 占比 |
|---------|--------|------|
| Battery_Empty | 4,157 | 48.1% |
| PV_Only_Idle | 2,658 | 30.8% |
| Charging | 1,129 | 13.1% |
| Battery_Only | 432 | 5.0% |
| PV_Battery_Mix | 264 | 3.1% |

---

## 🆚 与线性规划策略对比

| 指标 | 线性规划(LP) | 贪心策略V2 | 差异 |
|------|-------------|-----------|------|
| **累计净收益** | $131,953.55 | $119,784.02 | **-9.2%** ❌ |
| 年化估算 | $1,553,646.62 | $1,410,360.24 | -9.2% |
| **光伏直接上网** | 125,747 kWh (34.1%) | 184,595 kWh (50.1%) | **+46.8%** ✅ |
| **弃电率** | 98,085 kWh (26.6%) | 62,075 kWh (16.8%) | **-36.7%** ✅ |
| **储能放电** | 233,096 kWh | 157,372 kWh | -32.5% ❌ |
| **从电网购电** | 113,561 kWh | 52,220 kWh | **-54.0%** ✅ |

---

## 💡 策略特点

### ✅ **优势**

1. **逻辑清晰直观**：贪心策略易于理解和实施
2. **低弃电率**：16.8%（比LP策略低36.7%）
3. **高光伏利用率**：50.1%的光伏直接上网
4. **低电网依赖**：从电网购电量减少54%
5. **计算速度快**：秒级完成，无需求解器

### ❌ **劣势**

1. **收益次优**：比全局最优解低9.2%
2. **储能利用不足**：放电量比LP策略少32.5%
3. **可能错过套利机会**：贪心策略不考虑全局最优

---

## 🔧 参数配置

```python
NEL = 4440 kW              # 对电网最大输出功率
NIL = 670 kW               # 从电网最大输入功率
电池容量 = 5504 kWh
最大充电功率 = 2752 kW
最大放电功率 = 2752 kW
充电效率 = 95%
放电效率 = 95%
LGC限制 = -10 AUD/MWh
POA充电阈值 = 10 W/m²
POA白天阈值 = 5 W/m²
```

---

## 📁 输出文件

运行后生成以下文件：

```
optimization_results_greedy_v2/
├── detailed_results.csv      # 每5分钟时段的详细数据
├── daily_summary.csv          # 每日汇总数据
└── optimization_results.xlsx  # Excel格式完整报告
```

---

## 🚀 使用方法

```bash
python greedy_discharge_v2.py
```

**输入文件**: `excel_1117.csv`（需包含：日期、POA、电价RRP、光伏发电量等）

---

## 🤔 何时使用此策略

### 适用场景：
- ✅ 需要快速计算结果
- ✅ 追求简单可解释的策略
- ✅ 光伏资源充足
- ✅ 电价波动明显

### 不适用场景：
- ❌ 追求绝对最优收益
- ❌ 电价波动复杂，需全局优化
- ❌ 储能套利是主要收益来源

---

## 📝 关键公式

### 能量平衡

```
光伏发电 = 光伏充电 + 光伏上网 + 弃电
```

### Real Export（实际上网量）

```
Real Export = 光伏上网 + 储能上网
            = Export_PV_kWh + Export_Battery_kWh
```

### 能量守恒验证

```
(光伏发电 - 总充电 + 总放电) × 放电效率 ≈ Real Export
```

其中：
- 总充电 = 光伏充电 + 电网充电
- 总放电考虑效率损耗

---

## 🎓 总结

贪心放电策略是一种**实用的次优解**：

- 虽然收益比全局最优低9%，但：
  - 计算速度快（秒级 vs 分钟级）
  - 逻辑简单易懂
  - 弃电率更低
  - 对电网依赖更小

对于实际应用，这是一个**良好的平衡点**，在效率和收益之间取得了合理的权衡。

